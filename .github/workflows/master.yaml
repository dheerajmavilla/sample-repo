name: workflow for Master
on:
  push:
    branches:
      - "main"
    paths:
      - terraform/scripts/**
jobs:
  test_push:
    name: test_first
    runs-on: ubuntu-latest
    outputs:
      commit_id: ${{ steps.vars.outputs.sha_short }}
    steps:
      - name: Check out code
        uses: actions/checkout@v3
      - name: Set outputs
        id: vars
        run: echo "sha_short=$(git rev-parse --short HEAD)" >> $GITHUB_OUTPUT
  test: 
    name: test
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v3
        with:
          # We need to fetch all branches and commits so that Nx affected has a base to compare against.
          fetch-depth: 0
      - id: test_curl
        run: |
          export COMMIT_ID=${{ needs.test_push.outputs.commit_id }}
          echo $COMMIT_ID
          curl -X PATCH -H "Accept: application/vnd.github+json" -H "Authorization: Bearer ${{ secrets.MY_PAT }} " -H "X-GitHub-Api-Version: 2022-11-28" https://api.github.com/repos/dheerajmavilla/sample-repo/actions/variables/TEST_VARIABLE -d '{"name":"TEST_VARIABLE","value":"$COMMIT_ID"}'
      - name: job name
        id: job_name
        if: failure()
        run: |
          output_job=${{ github.job }}
          echo "output_job=$output_job" >> $GITHUB_OUTPUT
